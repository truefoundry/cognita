type: service
env:
  VITE_QA_FOUNDRY_URL: tfy-secret://truefoundry:docs-qa-secrets:QA_FOUNDRY_URL
  VITE_DOCS_QA_DELETE_COLLECTIONS: "false"
  VITE_DOCS_QA_ENABLE_REDIRECT: "false"
  VITE_DOCS_QA_MAX_UPLOAD_SIZE_MB: "200"
name: truefoundry-rag
image:
  type: build
  build_source:
    type: git
    repo_url: >-
      https://github.com/truefoundry/truefoundry-frontend-app?id=clgf5sxvb000016qq7kaqgh1w
    branch_name: main
    ref: 0a67654015dff23710c076186ca11b4f7377b645
  build_spec:
    type: dockerfile
    dockerfile_path: ./Dockerfile
    build_context_path: ./
    build_args:
      VITE_SKIP_SENTRY_SOURCE_MAP: "true"
ports:
  - port: 5000
    expose: true
    host: app.devtest.truefoundry.tech
    protocol: TCP
replicas: 1
resources:
  cpu_request: 0.03
  cpu_limit: 0.05
  memory_request: 200
  memory_limit: 300
  ephemeral_storage_request: 100
  ephemeral_storage_limit: 200
rollout_strategy:
  type: rolling_update
  max_surge_percentage: 25
  max_unavailable_percentage: 0
kustomize:
  additions:
    - kind: VirtualService
      spec:
        http:
          - match:
              - uri:
                  prefix: /api/tfy-build/
            route:
              - destination:
                  host: tfy-build-server.truefoundry.svc.cluster.local
                  port:
                    number: 5000
            rewrite:
              uri: /
          - route:
            - weight: 100
              destination:
                host: truefoundry-frontend-app
                port:
                  number: 5000
        hosts:
          - app.devtest.truefoundry.tech
          - '*.tenants.devtest.truefoundry.tech'
        gateways:
          - istio-system/tfy-wildcard
      metadata:
        name: truefoundry-frontend-app-proxy-vs
        namespace: truefoundry
      apiVersion: networking.istio.io/v1alpha3
